<?php
    use Permits\View\Helper\EcmtSection;
    $title = $this->translate('permits.application.overview.title');
    $this->headTitle($title);
    $application = $data['application'];
    $fee = $data['irhpFeeList'];
?>

<div class="row ecmt">
    <div class="two-thirds">
        <div class="page-header">
            <p><a href="<?php echo $this->url('permits') ?>" class="back-link"> <?php echo $this->escapeHtml($this->translate('common.link.back.label')); ?></a></p>
            <div class="page-header__wrapper">
                <h3 class="page-header__subtitle"><?php echo $this->escapeHtml($application['applicationRef']); ?></h3>
                <h1 class="js-title">
                    <?php echo $this->escapeHtml($this->translate('permits.application.overview.main')); ?>
                </h1>
            </div>
        </div>
        <?php echo $this->flashMessengerAll(); ?>

        <p class="extra-space large">You must complete all of the sections to apply for a new permit.<br>
            Further <a href=<?php echo $this->translate('permits.link.ecmt.guidance') ?>>guidance on ECMT permits</a> is available on GOV.UK.</p>

        <div class="field">
           <div class="table_wrapper">
               <ol class="overview__list">
                   <?php
                       $sections = $this->ecmtSection($application);

                       foreach ($sections as $section) {
                           echo $this->render($section);
                       }
                   ?>
               </ol>
            </div>
            <div class="actions-container new-application--wrapper">
                <?php if ($application['canBeSubmitted']) { ?>
                    <p><a href="<?php echo $this->url('permits/' . EcmtSection::ROUTE_ECMT_FEE, [], [], true); ?>" class="action--primary large"><?php echo $this->escapeHtml($this->translate('permits.button.accept-and-continue')); ?></a></p>
                <?php } ?>
            </div>
        </div>
    </div>
<!-- SIDE PANEL -->
    <div class="one-third">
        <aside class="sidebar" role="complementary">

            <div class="info-box info-box--grey">
                <h2 class="info-box__heading govuk-heading-l">Progress</h2>
                <p><b><?php echo $this->escapeHtml($application['sectionCompletion']['totalCompleted']); ?> of <?php echo $this->escapeHtml($application['sectionCompletion']['totalSections']); ?> complete</b></p>
                <p><b>Fee per permit </b> <?php echo $this->currencyFormatter($fee['appFee']); ?> <br />(non-refundable)</p>
                <p><b>Total application fee: </b> <?php echo $this->currencyFormatter($fee['appFee'] * $application['permitsRequired']); ?></p>
                <p>You can't submit until you've completed all of the sections</p>
            </div>

            <div class="info-box info-box--grey">
                <h3 class="info-box__heading">Application status</h3>
                <p class="info-box__icon-wrapper"><i class="info-box__icon selfserve-important"></i><?php echo $this->escapeHtml($application['status']['description']); ?></p>
                <?php
                    if ($application['canBeCancelled']) {
                ?>
                    <ul class="info-box__links">
                        <li>
                            <a href="<?php echo $this->url('permits/' . EcmtSection::ROUTE_ECMT_CANCEL_APPLICATION, [], [], true); ?>">Cancel application</a>
                        </li>
                    </ul>
                <?php
                    }
                ?>
            </div>

        </aside>
    </div>
</div>
