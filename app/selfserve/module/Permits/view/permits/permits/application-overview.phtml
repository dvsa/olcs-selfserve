<?php
    use Permits\View\Helper\EcmtSection;
    $title = $this->translate('permits.application.overview.title');
    $this->headTitle($title);
    $application = $data['application'];
    $fee = $data['irhpFeeList'];
?>

<div class="row ecmt">
    <div class="two-thirds">
        <div class="page-header">
            <p><a href="<?php echo $this->url('permits') ?>" class="back-link"> <?php echo $this->escapeHtml($this->translate('common.link.back.label')); ?></a></p>
            <div class="page-header__wrapper">
                <h3 class="page-header__subtitle"><?php echo $this->escapeHtml($application['applicationRef']); ?></h3>
                <h1 class="js-title">
                    <?php echo $this->escapeHtml($this->translate('permits.application.overview.main')); ?>
                </h1>
            </div>
        </div>
        <?php echo $this->flashMessengerAll(); ?>

        <p class="extra-space large">
            <?php echo $this->translate('permits.application.overview.complete-all-sections'); ?>
            <br>
            <?php
                $link = $this->translate('permits.link.ecmt.guidance');
                echo sprintf($this->translate('permits.application.overview.further-guidance'), $link);
            ?>
        </p>

        <div class="field">
            <div class="table_wrapper">
                <ol class="overview__list">
                    <?php
                    $sections = $this->ecmtSection($application);

                    foreach ($sections as $section) {
                        echo $this->render($section);
                    }
                    ?>
                </ol>
            </div>
            <?php
            if ($application['canBeSubmitted']) {
                $url = $this->url(EcmtSection::ROUTE_ECMT_FEE, [], [], true);

                if (!$application['hasOutstandingFees']) {
                    $url = $this->url(EcmtSection::ROUTE_ECMT_DECLARATION, [], [], true);
                }
            ?>
                <a href="<?php echo $url; ?>" class="govuk-button govuk-!-margin-top-5">
                    <?php echo $this->escapeHtml($this->translate('permits.button.accept-and-continue')); ?>
                </a>
            <?php } ?>
        </div>
    </div>
    <!-- SIDE PANEL -->
    <div class="one-third">
        <aside class="sidebar" role="complementary">

            <div class="info-box info-box--grey">
                <h3 class="info-box__heading">
                    <?php echo $this->translate('permits.application.overview.progress'); ?>
                </h3>
                <p>
                    <b><?php echo $this->escapeHtml($application['sectionCompletion']['totalCompleted']); ?>
                    of
                    <?php echo $this->escapeHtml($application['sectionCompletion']['totalSections']); ?> complete</b>
                </p>
                <p>
                    <b><?php echo $this->translate('permits.application.overview.fee-per-permit'); ?></b>
                    <?php echo $this->currencyFormatter($fee['appFee']); ?>
                    <br />
                    <?php echo $this->translate('permits.page.non.refundable'); ?>
                </p>
                <p>
                    <b><?php echo $this->translate('permits.application.overview.total-application-fee'); ?></b>
                    <?php echo $this->currencyFormatter($fee['appFee'] * $application['permitsRequired']); ?>
                </p>
                <p><?php echo $this->translate('permits.application.overview.complete-all-sections-warning'); ?></p>
            </div>

            <div class="info-box info-box--grey">
                <h3 class="info-box__heading"><?php echo $this->translate('permits.page.ecmt.consideration.application.status'); ?></h3>
                <p class="info-box__icon-wrapper"><i class="info-box__icon selfserve-important"></i><?php echo $this->escapeHtml($application['status']['description']); ?></p>
                <?php if ($application['canBeCancelled']) { ?>
                    <a href="<?php echo $this->url(EcmtSection::ROUTE_CANCEL_APPLICATION, [], [], true); ?>">
                        <?php echo $this->translate('permits.page.cancel.question'); ?>
                    </a>
                <?php } ?>
            </div>
        </aside>
    </div>
</div>
