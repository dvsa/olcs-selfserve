<?php
    $title = $this->translate('permits.page.fee.title');
    $this->headTitle($title);
    $application = $data['application'];
    $irhpPermitStock = $application['irhpPermitApplications'][0]['irhpPermitWindow']['irhpPermitStock'];
    $fee = $data['irhpFeeList'];
?>

<div class="row ecmt">
    <div class="two-thirds">
        <div class="page-header">
            <p><?php echo $this->permitsBackLink(); ?></p>
            <?php echo $this->formErrors($form); ?>
            <div class="page-header__wrapper">
                <h1 class="js-title">
                    <?php echo $this->escapeHtml($this->translate('permits.page.fee.main')); ?>
                </h1>
            </div>
        </div>

        <div class="field">
            <div class="govuk-hint">
                <p class="fee-subtitle"><?php echo $this->escapeHtml($this->translate('permits.page.fee.subtitle')); ?></p>
                <br />
                <div class="notice">
                    <i class="icon icon-important">
                        <span class="visually-hidden">warning message</span>
                    </i>
                    <strong>
                        <b>
                            <?php
                                echo sprintf($this->escapeHtml($this->translate('permits.page.fee.message')),
                                    $this->currencyFormatter($fee['issueFee']));
                            ?>
                        </b>
                    </strong>
                </div>
            </div>

            <div class="form-group">
                <dl>
                    <div>
                        <dt>
                            <?php echo $this->escapeHtml($this->translate('permits.page.fee.application.reference')); ?>
                        </dt>
                        <dd>
                            <?php echo $this->escapeHtml($application['applicationRef']); ?>
                        </dd>
                    </div>
                    <div>
                        <dt>
                            <?php echo $this->escapeHtml($this->translate('permits.page.fee.application.date')); ?>
                        </dt>
                        <dd>
                            <?php
                                $date = date_create($application['dateReceived']);
                                echo $this->escapeHtml(date_format($date, "d F Y"));
                            ?>
                        </dd>
                    </div>
                    <div>
                        <dt>
                            <?php echo $this->escapeHtml($this->translate('permits.page.fee.permit.type')); ?>
                        </dt>
                        <dd>
                            <?php echo $this->escapeHtml($application['permitType']['description']); ?>
                        </dd>
                    </div>
                    <div>
                        <dt>
                            <?php echo $this->escapeHtml($this->translate('permits.page.fee.permit.validity')); ?>
                        </dt>
                        <dd>
                            <?php echo $this->translateReplace(
                                'permits.page.fee.permit.validity.dates',
                                [
                                    $this->date(strtotime($irhpPermitStock['validFrom']), 'd F Y'),
                                    $this->date(strtotime($irhpPermitStock['validTo']), 'd F Y')
                                ]
                            ); ?>
                        </dd>
                    </div>
                    <div>
                        <dt>
                            <?php echo $this->escapeHtml($this->translate('permits.page.fee.number.permits')); ?>
                        </dt>
                        <dd>
                            <?php echo $this->escapeHtml($application['permitsRequired']) . ' x '; ?>
                            <?php
                                echo $this->currencyFormatter($fee['appFee']);
                                echo $this->escapeHtml($this->translate('permits.page.fee.per-permit'));
                            ?>
                        </dd>
                    </div>
                    <div>
                        <dt>
                            <?php echo $this->escapeHtml($this->translate('permits.page.fee.permit.fee.total')); ?>
                        </dt>
                        <dd>
                            <?php
                                echo $this->currencyFormatter($fee['appFee'] * $application['permitsRequired']);
                                echo $this->escapeHtml($this->translate('permits.page.fee.permit.fee.non-refundable'));
                            ?>
                        </dd>
                    </div>
                </dl>
            </div>

            <div class="actions-container new-application--wrapper">
                <?php echo $this->form($form); ?>
                <p><?php echo $this->permitsBackLink('permits.button.save-return-to-overview'); ?></p>
            </div>
        </div>
    </div>
</div>
