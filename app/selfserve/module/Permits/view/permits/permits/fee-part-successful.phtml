<?php
    use Permits\View\Helper\EcmtSection;

$title = $this->translate('permits.page.fee.title');
$this->headTitle($title);
$application = $data['application'];
$translatorHelper = $this->getHelperPluginManager()->getServiceLocator()->get('Helper\Translation');
$feeData = $this->ecmtFees($application, $data['irhpFeeList']);

?>

<div class="row ecmt">
    <div class="two-thirds">
        <div class="page-header">
            <p><a href="<?php echo $this->url('permits') ?>" class="back-link"> <?php echo $this->escapeHtml($this->translate('common.link.back.label')); ?></a></p>
            <?php echo $this->formErrors($form); ?>

            <div class="page-header__wrapper">
                <h1 class="js-title">
                    <?php echo $this->escapeHtml($this->translate('permits.page.fee-part-successful.title')); ?>
                    <?php
                    $markup = ($application['irhpPermitApplications'][0]['permitsAwarded'] === $application['permitsRequired']) ? 'markup-ecmt-fee-successful-hint' : 'markup-ecmt-fee-part-successful-hint';
                    echo $translatorHelper->translateReplace(
                            $markup,
                            [$application['irhpPermitApplications'][0]['permitsAwarded'],
                             $application['permitsRequired']]
                    ); ?>
                </h1>
            </div>
        </div>
        <div class="field">
            <div class="form-group form-steps ">
                <div class="form-group">
                    <dl>
                        <dt><?php echo $this->escapeHtml($this->translate('permits.page.ecmt.consideration.reference.number')); ?></dt>
                        <dd>
                            <?php echo $this->escapeHtml($application['applicationRef']); ?>
                        </dd>

                        <dt><?php echo $this->escapeHtml($this->translate('permits.page.ecmt.consideration.permit.type')); ?></dt>
                        <dd>
                            <?php echo $this->escapeHtml($application['permitType']['description']); ?>
                        </dd>

                        <dt><?php echo $this->escapeHtml($this->translate('permits.page.ecmt.fee-part-successful.permit.validity')); ?></dt>
                        <dd>
                            <?php
                                echo date(\DATE_FORMAT, strtotime($application['irhpPermitApplications'][0]['irhpPermitWindow']['irhpPermitStock']['validFrom']));
                                echo ' ' . $this->translate('to') . ' ';
                                echo date(\DATE_FORMAT, strtotime($application['irhpPermitApplications'][0]['irhpPermitWindow']['irhpPermitStock']['validTo']));
                            ?>
                        </dd>

                        <dt><?php echo $this->escapeHtml($this->translate('permits.page.ecmt.fee-part-successful.issuing.fee')); ?></dt>
                        <dd>
                            <?php echo $application['irhpPermitApplications'][0]['permitsAwarded']; ?> x
                            <?php echo $this->currencyFormatter($data['irhpFeeList']['issueFee']); ?> <br />
                            <a href="<?php echo $this->url('permits/' . EcmtSection::ROUTE_ECMT_PARTIAL_PERMITS, [], [], true); ?>">
                                <?php echo $this->escapeHtml($this->translate('permits.page.view.permits')); ?>
                            </a>
                        </dd>

                        <dt><?php echo $this->escapeHtml($this->translate('permits.page.ecmt.fee-part-successful.issuing.fee.total')); ?></dt>
                        <dd><?php echo $this->currencyFormatter($feeData['totalFee']); ?> <?php echo $this->escapeHtml($this->translate('permits.page.non.refundable')); ?></dd>

                        <dt><?php echo $this->escapeHtml($this->translate('permits.page.ecmt.fee-part-successful.payment.due')); ?></dt>
                        <dd><?php echo date(\DATE_FORMAT, strtotime($feeData['dueDate'])); ?></dd>
                    </dl>
                </div>
            </div>
            <?php echo $this->form($form); ?>
            <p><a href="<?php echo $this->url('permits') ?>"> <?php echo $this->escapeHtml($this->translate('permits.link.cancel.return.to.dashboard')); ?></a></p>
        </div>
    </div>
</div>
